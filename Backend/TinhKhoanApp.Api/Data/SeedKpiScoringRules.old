using TinhKhoanApp.Api.Data;
using TinhKhoanApp.Api.Models;

namespace TinhKhoanApp.Api.Data
{
    /// <summary>
    /// Seed dữ liệu mẫu cho bảng quy tắc tính điểm KPI chi nhánh
    /// </summary>
    public static class SeedKpiScoringRules
    {
        public static void SeedData(ApplicationDbContext context)
        {
            // Kiểm tra xem đã có dữ liệu chưa
            if (!context.KpiScoringRules.Any())
            {
                var rules = new List<KpiScoringRule>
                {
                    // Các chỉ tiêu về nguồn vốn huy động
                    new KpiScoringRule
                    {
                        KpiIndicatorName = "Tăng trưởng nguồn vốn huy động cuối kỳ",
                        KpiIndicatorCode = "TTVHD_CK",
                        ScoringMethod = "LINEAR",
                        PercentageStep = 10m, // Cứ 10%
                        ScorePerStep = 1m,    // Cộng/trừ 1 điểm
                        MaxScore = 10m,
                        MinScore = -10m,
                        Description = "Cứ tăng (giảm) 10% so với kế hoạch thì cộng (trừ) 1 điểm",
                        ApplicableUnitType = "ALL",
                        CreatedBy = "System"
                    },
                    new KpiScoringRule
                    {
                        KpiIndicatorName = "Nguồn vốn huy động bình quân",
                        KpiIndicatorCode = "NVHD_BQ",
                        ScoringMethod = "LINEAR",
                        PercentageStep = 5m,  // Cứ 5%
                        ScorePerStep = 1.5m,  // Cộng/trừ 1.5 điểm
                        MaxScore = 15m,
                        MinScore = -15m,
                        Description = "Cứ tăng (giảm) 5% so với kế hoạch thì cộng (trừ) 1.5 điểm",
                        ApplicableUnitType = "ALL",
                        CreatedBy = "System"
                    },

                    // Các chỉ tiêu về dư nợ
                    new KpiScoringRule
                    {
                        KpiIndicatorName = "Tăng trưởng dư nợ cuối kỳ",
                        KpiIndicatorCode = "TTDN_CK",
                        ScoringMethod = "LINEAR",
                        PercentageStep = 10m,
                        ScorePerStep = 1m,
                        MaxScore = 10m,
                        MinScore = -10m,
                        Description = "Cứ tăng (giảm) 10% so với kế hoạch thì cộng (trừ) 1 điểm",
                        ApplicableUnitType = "ALL",
                        CreatedBy = "System"
                    },
                    new KpiScoringRule
                    {
                        KpiIndicatorName = "Tổng dư nợ bình quân",
                        KpiIndicatorCode = "TDN_BQ",
                        ScoringMethod = "LINEAR",
                        PercentageStep = 5m,
                        ScorePerStep = 1.5m,
                        MaxScore = 15m,
                        MinScore = -15m,
                        Description = "Cứ tăng (giảm) 5% so với kế hoạch thì cộng (trừ) 1.5 điểm",
                        ApplicableUnitType = "ALL",
                        CreatedBy = "System"
                    },
                    new KpiScoringRule
                    {
                        KpiIndicatorName = "Tổng dư nợ HSX&CN",
                        KpiIndicatorCode = "TDN_HSXCN",
                        ScoringMethod = "LINEAR",
                        PercentageStep = 10m,
                        ScorePerStep = 0.5m,
                        MaxScore = 5m,
                        MinScore = -5m,
                        Description = "Cứ tăng (giảm) 10% so với kế hoạch thì cộng (trừ) 0.5 điểm",
                        ApplicableUnitType = "ALL",
                        CreatedBy = "System"
                    },

                    // Các chỉ tiêu chất lượng tín dụng (ngược chiều)
                    new KpiScoringRule
                    {
                        KpiIndicatorName = "Tỷ lệ nợ xấu",
                        KpiIndicatorCode = "TLNX",
                        ScoringMethod = "REVERSE_LINEAR",
                        PercentageStep = 10m,
                        ScorePerStep = 1m,
                        MaxScore = 10m,
                        MinScore = -10m,
                        Description = "Cứ tăng (giảm) 10% so với kế hoạch thì trừ (cộng) 1 điểm",
                        ApplicableUnitType = "ALL",
                        CreatedBy = "System"
                    },
                    new KpiScoringRule
                    {
                        KpiIndicatorName = "Thu nợ đã XLRR",
                        KpiIndicatorCode = "TN_XLRR",
                        ScoringMethod = "LINEAR",
                        PercentageStep = 10m,
                        ScorePerStep = 0.5m,
                        MaxScore = 5m,
                        MinScore = -5m,
                        Description = "Cứ tăng (giảm) 10% so với kế hoạch thì cộng (trừ) 0.5 điểm",
                        ApplicableUnitType = "ALL",
                        CreatedBy = "System"
                    },

                    // Các chỉ tiêu thu nhập
                    new KpiScoringRule
                    {
                        KpiIndicatorName = "Tỷ lệ thực thu lãi",
                        KpiIndicatorCode = "TLTL",
                        ScoringMethod = "LINEAR",
                        PercentageStep = 5m,
                        ScorePerStep = 1m,
                        MaxScore = 10m,
                        MinScore = -10m,
                        Description = "Cứ tăng (giảm) 5% so với kế hoạch thì cộng (trừ) 1 điểm",
                        ApplicableUnitType = "ALL",
                        CreatedBy = "System"
                    },
                    new KpiScoringRule
                    {
                        KpiIndicatorName = "Lợi nhuận khoán tài chính",
                        KpiIndicatorCode = "LN_KHTC",
                        ScoringMethod = "LINEAR",
                        PercentageStep = 10m,
                        ScorePerStep = 1.5m,
                        MaxScore = 15m,
                        MinScore = -15m,
                        Description = "Cứ tăng (giảm) 10% so với kế hoạch thì cộng (trừ) 1.5 điểm",
                        ApplicableUnitType = "ALL",
                        CreatedBy = "System"
                    },
                    new KpiScoringRule
                    {
                        KpiIndicatorName = "Thu dịch vụ",
                        KpiIndicatorCode = "TDV",
                        ScoringMethod = "LINEAR",
                        PercentageStep = 10m,
                        ScorePerStep = 1.5m,
                        MaxScore = 15m,
                        MinScore = -15m,
                        Description = "Cứ tăng (giảm) 10% so với kế hoạch thì cộng (trừ) 1.5 điểm",
                        ApplicableUnitType = "ALL",
                        CreatedBy = "System"
                    },

                    // Các chỉ tiêu đặc biệt cho CNL1
                    new KpiScoringRule
                    {
                        KpiIndicatorName = "Hoàn thành nhiệm vụ chính trị",
                        KpiIndicatorCode = "HTNV_CT",
                        ScoringMethod = "THRESHOLD",
                        PercentageStep = 100m, // Chỉ tính khi hoàn thành 100%
                        ScorePerStep = 5m,
                        MaxScore = 5m,
                        MinScore = 0m,
                        Description = "Hoàn thành 100% nhiệm vụ chính trị được cộng 5 điểm",
                        ApplicableUnitType = "CNL1",
                        CreatedBy = "System"
                    },

                    // Các chỉ tiêu đặc biệt cho CNL2
                    new KpiScoringRule
                    {
                        KpiIndicatorName = "Phát triển khách hàng mới",
                        KpiIndicatorCode = "PTKH_MOI",
                        ScoringMethod = "LINEAR",
                        PercentageStep = 20m, // Cứ 20%
                        ScorePerStep = 2m,    // Cộng/trừ 2 điểm
                        MaxScore = 10m,
                        MinScore = -10m,
                        Description = "Cứ tăng (giảm) 20% so với kế hoạch thì cộng (trừ) 2 điểm",
                        ApplicableUnitType = "CNL2",
                        CreatedBy = "System"
                    }
                };

                context.KpiScoringRules.AddRange(rules);
                context.SaveChanges();

                Console.WriteLine($"✅ Đã seed {rules.Count} quy tắc tính điểm KPI!");
            }
            else
            {
                Console.WriteLine("ℹ️ Bảng KpiScoringRules đã có dữ liệu, bỏ qua seed.");
            }
        }
    }
}
