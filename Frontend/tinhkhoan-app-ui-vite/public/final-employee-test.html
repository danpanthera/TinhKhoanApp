<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Employee Test</title>
</head>
<body>
    <h1>Final Employee Test</h1>
    <button onclick="finalTest()">Run Final Test</button>
    <div id="results"></div>

    <script>
        async function finalTest() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Testing...</p>';

            try {
                // Test API call
                const response = await fetch('http://localhost:5055/api/Employees');
                const data = await response.json();

                console.log('API Response:', data);

                // Test each employee
                let html = '<h2>Final Test Results</h2>';
                html += `<p><strong>Total from API:</strong> ${data.length}</p>`;

                let validCount = 0;
                let invalidCount = 0;

                data.forEach((employee, index) => {
                    const mapped = {
                        Id: employee.Id,
                        EmployeeCode: employee.EmployeeCode || '',
                        CBCode: employee.CBCode || '',
                        FullName: employee.FullName || '',
                        Username: employee.Username || ''
                    };

                    // New simple validation
                    const isValid = mapped.Id && (mapped.EmployeeCode || mapped.FullName || mapped.Username);

                    if (isValid) {
                        validCount++;
                        html += `<div style="background: #d4edda; padding: 10px; margin: 5px; border-radius: 5px;">
                            <strong>✅ Employee ${index + 1}: ${mapped.FullName || 'No name'}</strong><br>
                            ID: ${mapped.Id}, Code: ${mapped.EmployeeCode}, Username: ${mapped.Username}
                        </div>`;
                    } else {
                        invalidCount++;
                        html += `<div style="background: #f8d7da; padding: 10px; margin: 5px; border-radius: 5px;">
                            <strong>❌ Employee ${index + 1}: Invalid</strong><br>
                            ID: ${mapped.Id}, Code: ${mapped.EmployeeCode}, Name: ${mapped.FullName}, Username: ${mapped.Username}
                        </div>`;
                    }
                });

                html += `<h3>Summary: ${validCount} valid, ${invalidCount} invalid</h3>`;

                // Test Vue store call (if possible)
                if (window.fetch) {
                    try {
                        const storeResponse = await fetch('/api/Employees', {
                            headers: {
                                'Accept': 'application/json',
                                'Content-Type': 'application/json'
                            }
                        });
                        html += `<p><strong>Store-style API call:</strong> ${storeResponse.status} ${storeResponse.statusText}</p>`;
                    } catch (e) {
                        html += `<p><strong>Store-style API call failed:</strong> ${e.message}</p>`;
                    }
                }

                resultsDiv.innerHTML = html;

            } catch (error) {
                console.error('Error:', error);
                resultsDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
