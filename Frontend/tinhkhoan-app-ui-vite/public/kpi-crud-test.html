<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KPI CRUD API Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-section { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .test-button { background: #8B1538; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        .test-button:hover { background: #A91B47; }
        .result { background: #f8f9fa; padding: 10px; border-radius: 4px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; }
        .success { border-left: 4px solid #28a745; }
        .error { border-left: 4px solid #dc3545; }
        h1 { color: #8B1538; text-align: center; }
        h2 { color: #333; border-bottom: 2px solid #8B1538; padding-bottom: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ KPI CRUD API Testing Tool</h1>
        <p style="text-align: center; color: #666;">Test the new KPI Indicator CRUD functionality</p>

        <div class="test-section">
            <h2>üìã 1. Get KPI Tables</h2>
            <button class="test-button" onclick="testGetTables()">Test GET Tables</button>
            <div id="tables-result" class="result"></div>
        </div>

        <div class="test-section">
            <h2>üìä 2. Get Table Details</h2>
            <input type="number" id="table-id" placeholder="Table ID (e.g., 1002)" value="1002" style="padding: 8px; margin: 5px;">
            <button class="test-button" onclick="testGetTableDetails()">Test GET Details</button>
            <div id="details-result" class="result"></div>
        </div>

        <div class="test-section">
            <h2>‚ûï 3. Create New Indicator</h2>
            <div style="margin: 10px 0;">
                <input type="text" id="indicator-name" placeholder="Indicator Name" value="Test Indicator" style="padding: 8px; margin: 5px; width: 200px;">
                <input type="number" id="max-score" placeholder="Max Score" value="100" style="padding: 8px; margin: 5px; width: 100px;">
                <input type="text" id="unit" placeholder="Unit" value="%" style="padding: 8px; margin: 5px; width: 80px;">
                <select id="value-type" style="padding: 8px; margin: 5px;">
                    <option value="NUMBER">Number</option>
                    <option value="PERCENTAGE">Percentage</option>
                    <option value="CURRENCY">Currency</option>
                    <option value="TEXT">Text</option>
                </select>
            </div>
            <button class="test-button" onclick="testCreateIndicator()">Test CREATE Indicator</button>
            <div id="create-result" class="result"></div>
        </div>

        <div class="test-section">
            <h2>‚úèÔ∏è 4. Update Indicator</h2>
            <div style="margin: 10px 0;">
                <input type="number" id="update-id" placeholder="Indicator ID" style="padding: 8px; margin: 5px; width: 100px;">
                <input type="text" id="update-name" placeholder="New Name" value="Updated Test Indicator" style="padding: 8px; margin: 5px; width: 200px;">
                <input type="number" id="update-score" placeholder="New Max Score" value="150" style="padding: 8px; margin: 5px; width: 100px;">
            </div>
            <button class="test-button" onclick="testUpdateIndicator()">Test UPDATE Indicator</button>
            <div id="update-result" class="result"></div>
        </div>

        <div class="test-section">
            <h2>üóëÔ∏è 5. Delete Indicator</h2>
            <input type="number" id="delete-id" placeholder="Indicator ID to delete" style="padding: 8px; margin: 5px; width: 150px;">
            <button class="test-button" onclick="testDeleteIndicator()" style="background: #dc3545;">Test DELETE Indicator</button>
            <div id="delete-result" class="result"></div>
        </div>

        <div class="test-section">
            <h2>üîÑ 6. Reorder Indicator</h2>
            <div style="margin: 10px 0;">
                <input type="number" id="reorder-id" placeholder="Indicator ID" style="padding: 8px; margin: 5px; width: 100px;">
                <input type="number" id="new-order" placeholder="New Order Index" value="1" style="padding: 8px; margin: 5px; width: 120px;">
            </div>
            <button class="test-button" onclick="testReorderIndicator()">Test REORDER Indicator</button>
            <div id="reorder-result" class="result"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5055/api/KpiAssignment';
        
        function displayResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.textContent = JSON.stringify(data, null, 2);
            element.className = `result ${isError ? 'error' : 'success'}`;
        }

        async function apiCall(url, options = {}) {
            try {
                const response = await fetch(url, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                
                const data = await response.json();
                return { success: response.ok, data, status: response.status };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        async function testGetTables() {
            const result = await apiCall(`${API_BASE}/tables`);
            displayResult('tables-result', result, !result.success);
        }

        async function testGetTableDetails() {
            const tableId = document.getElementById('table-id').value;
            const result = await apiCall(`${API_BASE}/tables/${tableId}/details`);
            displayResult('details-result', result, !result.success);
        }

        async function testCreateIndicator() {
            const tableId = document.getElementById('table-id').value;
            const indicatorData = {
                kpiAssignmentTableId: parseInt(tableId),
                indicatorName: document.getElementById('indicator-name').value,
                maxScore: parseFloat(document.getElementById('max-score').value),
                unit: document.getElementById('unit').value,
                valueTypeString: document.getElementById('value-type').value,
                isActive: true
            };
            
            const result = await apiCall(`${API_BASE}/indicators`, {
                method: 'POST',
                body: JSON.stringify(indicatorData)
            });
            displayResult('create-result', result, !result.success);
        }

        async function testUpdateIndicator() {
            const indicatorId = document.getElementById('update-id').value;
            const updateData = {
                indicatorName: document.getElementById('update-name').value,
                maxScore: parseFloat(document.getElementById('update-score').value),
                unit: document.getElementById('unit').value,
                valueTypeString: document.getElementById('value-type').value,
                isActive: true
            };
            
            const result = await apiCall(`${API_BASE}/indicators/${indicatorId}`, {
                method: 'PUT',
                body: JSON.stringify(updateData)
            });
            displayResult('update-result', result, !result.success);
        }

        async function testDeleteIndicator() {
            const indicatorId = document.getElementById('delete-id').value;
            const result = await apiCall(`${API_BASE}/indicators/${indicatorId}`, {
                method: 'DELETE'
            });
            displayResult('delete-result', result, !result.success);
        }

        async function testReorderIndicator() {
            const indicatorId = document.getElementById('reorder-id').value;
            const newOrder = parseInt(document.getElementById('new-order').value);
            
            const result = await apiCall(`${API_BASE}/indicators/${indicatorId}/reorder`, {
                method: 'PUT',
                body: JSON.stringify({ newOrderIndex: newOrder })
            });
            displayResult('reorder-result', result, !result.success);
        }

        // Auto-load tables on page load
        window.onload = () => {
            testGetTables();
        };
    </script>
</body>
</html>
