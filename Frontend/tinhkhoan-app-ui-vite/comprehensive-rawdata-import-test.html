<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive RawData Import Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .api-test {
            background-color: #e8f5e8;
            border-left: 4px solid #27ae60;
        }
        .file-test {
            background-color: #e8f4fd;
            border-left: 4px solid #3498db;
        }
        .endpoint-test {
            background-color: #fff3e0;
            border-left: 4px solid #f39c12;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background-color: #2980b9;
        }
        button.success {
            background-color: #27ae60;
        }
        button.error {
            background-color: #e74c3c;
        }
        .result {
            margin: 15px 0;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .result.success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .result.error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .result.info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .file-upload {
            margin: 15px 0;
        }
        .file-upload input[type="file"] {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 100%;
            max-width: 400px;
        }
        .table-select {
            margin: 10px 0;
        }
        .table-select select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background-color: #3498db;
            transition: width 0.3s;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background-color: #27ae60; }
        .status-error { background-color: #e74c3c; }
        .status-pending { background-color: #f39c12; }
        .status-info { background-color: #3498db; }
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            text-align: center;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        .stat-label {
            color: #7f8c8d;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Comprehensive RawData Import Test Suite</h1>
        <p>This test suite comprehensively tests the RawData import functionality including backend endpoints, file validation, import processes, and frontend integration.</p>
        
        <!-- API Status Tests -->
        <div class="test-section api-test">
            <h2>üì° API Status & Connectivity Tests</h2>
            <button onclick="testApiHealth()">Test API Health</button>
            <button onclick="testImportStatistics()">Test Import Statistics</button>
            <button onclick="testRecentImports()">Test Recent Imports</button>
            <div id="api-results" class="result info"></div>
        </div>

        <!-- File Upload Tests -->
        <div class="test-section file-test">
            <h2>üìÅ File Upload & Validation Tests</h2>
            <div class="table-select">
                <label for="tableType">Select Table Type:</label>
                <select id="tableType">
                    <option value="LN01">LN01 - Company Information</option>
                    <option value="GL01">GL01 - Accounting Entries</option>
                    <option value="DP01">DP01 - Customer Information</option>
                </select>
            </div>
            <div class="file-upload">
                <label for="excelFile">Select Excel File:</label>
                <input type="file" id="excelFile" accept=".xlsx,.xls" />
            </div>
            <button onclick="validateFile()">Validate File</button>
            <button onclick="importFile()">Import File</button>
            <button onclick="createTestExcelFile()">Create Test Excel File</button>
            <div class="progress-bar" id="upload-progress" style="display: none;">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div id="file-results" class="result info"></div>
        </div>

        <!-- Endpoint Tests -->
        <div class="test-section endpoint-test">
            <h2>üéØ Individual Endpoint Tests</h2>
            <button onclick="testLN01Upload()">Test LN01 Upload</button>
            <button onclick="testGL01Upload()">Test GL01 Upload</button>
            <button onclick="testDP01Upload()">Test DP01 Upload</button>
            <button onclick="testHistoryEndpoints()">Test History Endpoints</button>
            <button onclick="testSnapshotEndpoints()">Test Snapshot Endpoints</button>
            <button onclick="testCleanupEndpoints()">Test Cleanup Endpoints</button>
            <div id="endpoint-results" class="result info"></div>
        </div>

        <!-- Test Results Summary -->
        <div class="test-section">
            <h2>üìä Test Results Summary</h2>
            <div class="summary-stats" id="summary-stats">
                <div class="stat-card">
                    <div class="stat-number" id="total-tests">0</div>
                    <div class="stat-label">Total Tests</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="passed-tests">0</div>
                    <div class="stat-label">Passed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="failed-tests">0</div>
                    <div class="stat-label">Failed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="test-coverage">0%</div>
                    <div class="stat-label">Coverage</div>
                </div>
            </div>
            <div id="summary-results" class="result info"></div>
        </div>

        <!-- Run All Tests -->
        <div style="text-align: center; margin: 30px 0;">
            <button onclick="runAllTests()" style="background-color: #e74c3c; font-size: 16px; padding: 15px 30px;">
                üöÄ Run All Tests
            </button>
            <button onclick="clearResults()" style="background-color: #95a5a6;">
                üóëÔ∏è Clear Results
            </button>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:5055/api';
        let testResults = {
            total: 0,
            passed: 0,
            failed: 0,
            tests: []
        };

        function updateTestStats() {
            document.getElementById('total-tests').textContent = testResults.total;
            document.getElementById('passed-tests').textContent = testResults.passed;
            document.getElementById('failed-tests').textContent = testResults.failed;
            document.getElementById('test-coverage').textContent = 
                testResults.total > 0 ? Math.round((testResults.passed / testResults.total) * 100) + '%' : '0%';
        }

        function logTest(name, success, details = '') {
            testResults.total++;
            if (success) {
                testResults.passed++;
            } else {
                testResults.failed++;
            }
            testResults.tests.push({
                name,
                success,
                details,
                timestamp: new Date().toISOString()
            });
            updateTestStats();
        }

        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${type}`;
        }

        function showProgress(show, percent = 0) {
            const progressBar = document.getElementById('upload-progress');
            const progressFill = document.getElementById('progress-fill');
            
            if (show) {
                progressBar.style.display = 'block';
                progressFill.style.width = percent + '%';
            } else {
                progressBar.style.display = 'none';
            }
        }

        async function testApiHealth() {
            try {
                showResult('api-results', 'üîÑ Testing API connectivity...', 'info');
                
                // Test basic API connectivity
                const healthResponse = await fetch(`${API_BASE_URL}/RawDataImport/statistics`);
                const healthData = await healthResponse.json();
                
                if (healthResponse.ok) {
                    logTest('API Health Check', true, 'API is accessible and responsive');
                    showResult('api-results', 
                        `‚úÖ API Health Check PASSED\n\n` +
                        `Status: ${healthResponse.status}\n` +
                        `Response: ${JSON.stringify(healthData, null, 2)}`, 
                        'success'
                    );
                } else {
                    logTest('API Health Check', false, `HTTP ${healthResponse.status}`);
                    showResult('api-results', 
                        `‚ùå API Health Check FAILED\n\n` +
                        `Status: ${healthResponse.status}\n` +
                        `Error: ${JSON.stringify(healthData, null, 2)}`, 
                        'error'
                    );
                }
            } catch (error) {
                logTest('API Health Check', false, error.message);
                showResult('api-results', 
                    `‚ùå API Health Check FAILED\n\n` +
                    `Error: ${error.message}\n` +
                    `Make sure the backend is running on port 5055`, 
                    'error'
                );
            }
        }

        async function testImportStatistics() {
            try {
                showResult('api-results', 'üîÑ Testing import statistics...', 'info');
                
                const response = await fetch(`${API_BASE_URL}/RawDataImport/statistics`);
                const data = await response.json();
                
                if (response.ok) {
                    logTest('Import Statistics', true, 'Statistics endpoint working');
                    showResult('api-results', 
                        `‚úÖ Import Statistics PASSED\n\n` +
                        `LN01 Total Imports: ${data.lN01?.totalImports || 0}\n` +
                        `GL01 Total Imports: ${data.gL01?.totalImports || 0}\n` +
                        `DP01 Total Imports: ${data.dP01?.totalImports || 0}\n\n` +
                        `Full Response:\n${JSON.stringify(data, null, 2)}`, 
                        'success'
                    );
                } else {
                    logTest('Import Statistics', false, `HTTP ${response.status}`);
                    showResult('api-results', 
                        `‚ùå Import Statistics FAILED\n\n` +
                        `Status: ${response.status}\n` +
                        `Error: ${JSON.stringify(data, null, 2)}`, 
                        'error'
                    );
                }
            } catch (error) {
                logTest('Import Statistics', false, error.message);
                showResult('api-results', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function testRecentImports() {
            try {
                showResult('api-results', 'üîÑ Testing recent imports...', 'info');
                
                const response = await fetch(`${API_BASE_URL}/RawDataImport/recent?limit=10`);
                const data = await response.json();
                
                if (response.ok) {
                    logTest('Recent Imports', true, 'Recent imports endpoint working');
                    showResult('api-results', 
                        `‚úÖ Recent Imports PASSED\n\n` +
                        `Found ${Array.isArray(data) ? data.length : 0} recent imports\n\n` +
                        `Response:\n${JSON.stringify(data, null, 2)}`, 
                        'success'
                    );
                } else {
                    logTest('Recent Imports', false, `HTTP ${response.status}`);
                    showResult('api-results', 
                        `‚ùå Recent Imports FAILED\n\n` +
                        `Status: ${response.status}\n` +
                        `Error: ${JSON.stringify(data, null, 2)}`, 
                        'error'
                    );
                }
            } catch (error) {
                logTest('Recent Imports', false, error.message);
                showResult('api-results', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        function createTestExcelFile() {
            const tableType = document.getElementById('tableType').value;
            showResult('file-results', 'üîÑ Creating test Excel file...', 'info');
            
            // Create a simple CSV that will be converted to Excel
            let csvContent = '';
            let filename = '';
            
            if (tableType === 'LN01') {
                csvContent = 'SourceID,MANDT,BUKRS,LAND1,WAERS,SPRAS,KTOPL,WAABW,PERIV,KOKFI,RCOMP,ADRNR,STCEG,FIKRS,XFMCO,XFMCB,XFMCA,TXJCD\n';
                csvContent += 'LN01_001,800,7801,VN,VND,V,VFCA,X,K4,FI01,7801,12345,123456789,FI01,X,X,X,V0\n';
                csvContent += 'LN01_002,800,7802,VN,VND,V,VFCA,X,K4,FI01,7802,12346,123456790,FI01,X,X,X,V0\n';
                filename = 'test_LN01_import.csv';
            } else if (tableType === 'GL01') {
                csvContent = 'SourceID,MANDT,BUKRS,GJAHR,BELNR,BUZEI,AUGDT,AUGCP,AUGBL,BSCHL,KOART,UMSKZ,UMSKS,ZUMSK,SHKZG,GSBER,PARGB,MWSKZ,QSSKZ,DMBTR,WRBTR,KZBTR,PSWBT,PSWSL,HKONT,KUNNR,LIFNR,SGTXT\n';
                csvContent += 'GL01_001,800,7801,2025,1000000001,001,,,,40,D,,,,,S,,,,,1000000,1000000,1000000,1000000,VND,1110000000,,,Test GL01 Entry 1\n';
                csvContent += 'GL01_002,800,7801,2025,1000000002,001,,,,50,K,,,,,H,,,,,2000000,2000000,2000000,2000000,VND,2110000000,,,Test GL01 Entry 2\n';
                filename = 'test_GL01_import.csv';
            } else if (tableType === 'DP01') {
                csvContent = 'SourceID,MANDT,KUNNR,LAND1,NAME1,NAME2,ORT01,PSTLZ,REGIO,SPRAS,TELF1,TELFX,SMTP_ADDR\n';
                csvContent += 'DP01_001,800,1000000001,VN,NGUYEN VAN A,Company A,Ha Noi,100000,01,V,0241234567,0241234568,nguyenvana@company.com\n';
                csvContent += 'DP01_002,800,1000000002,VN,LE THI B,Company B,Ho Chi Minh,700000,79,V,0281234567,0281234568,lethib@company.com\n';
                filename = 'test_DP01_import.csv';
            }
            
            // Create and download the CSV file
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            logTest('Create Test File', true, `Created ${filename}`);
            showResult('file-results', 
                `‚úÖ Test file created successfully!\n\n` +
                `File: ${filename}\n` +
                `Type: ${tableType}\n` +
                `Records: ${csvContent.split('\n').length - 2}\n\n` +
                `Note: This is a CSV file. The backend expects Excel format.\n` +
                `Please convert to .xlsx format before importing.`, 
                'success'
            );
        }

        async function validateFile() {
            const fileInput = document.getElementById('excelFile');
            const tableType = document.getElementById('tableType').value;
            
            if (!fileInput.files[0]) {
                showResult('file-results', '‚ùå Please select a file first', 'error');
                return;
            }
            
            const file = fileInput.files[0];
            showResult('file-results', 'üîÑ Validating file...', 'info');
            
            try {
                const formData = new FormData();
                formData.append('file', file);
                
                const response = await fetch(`${API_BASE_URL}/RawDataImport/validate-file?tableType=${tableType}`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    logTest('File Validation', data.isValid, `File validation for ${tableType}`);
                    showResult('file-results', 
                        `${data.isValid ? '‚úÖ' : '‚ùå'} File Validation ${data.isValid ? 'PASSED' : 'FAILED'}\n\n` +
                        `Message: ${data.message}\n` +
                        `Row Count: ${data.rowCount || 'Unknown'}\n` +
                        `Missing Headers: ${data.missingHeaders?.join(', ') || 'None'}\n` +
                        `Extra Headers: ${data.extraHeaders?.join(', ') || 'None'}\n\n` +
                        `Full Response:\n${JSON.stringify(data, null, 2)}`, 
                        data.isValid ? 'success' : 'error'
                    );
                } else {
                    logTest('File Validation', false, `HTTP ${response.status}`);
                    showResult('file-results', 
                        `‚ùå File Validation FAILED\n\n` +
                        `Status: ${response.status}\n` +
                        `Error: ${JSON.stringify(data, null, 2)}`, 
                        'error'
                    );
                }
            } catch (error) {
                logTest('File Validation', false, error.message);
                showResult('file-results', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function importFile() {
            const fileInput = document.getElementById('excelFile');
            const tableType = document.getElementById('tableType').value;
            
            if (!fileInput.files[0]) {
                showResult('file-results', '‚ùå Please select a file first', 'error');
                return;
            }
            
            const file = fileInput.files[0];
            showResult('file-results', 'üîÑ Importing file...', 'info');
            showProgress(true, 0);
            
            try {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('tableName', tableType);
                formData.append('batchId', `TEST_${tableType}_${Date.now()}`);
                formData.append('createdBy', 'TEST_USER');
                
                // Simulate progress
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += Math.random() * 10;
                    if (progress > 90) progress = 90;
                    showProgress(true, progress);
                }, 200);
                
                const response = await fetch(`${API_BASE_URL}/RawDataImport/${tableType.toLowerCase()}/upload`, {
                    method: 'POST',
                    body: formData
                });
                
                clearInterval(progressInterval);
                showProgress(true, 100);
                
                const data = await response.json();
                
                if (response.ok) {
                    logTest('File Import', data.success, `Import for ${tableType}`);
                    showResult('file-results', 
                        `${data.success ? '‚úÖ' : '‚ùå'} File Import ${data.success ? 'PASSED' : 'FAILED'}\n\n` +
                        `Message: ${data.message}\n` +
                        `Batch ID: ${data.batchId || 'N/A'}\n` +
                        `Statistics: ${JSON.stringify(data.statistics, null, 2)}\n` +
                        `Warnings: ${data.warnings?.length || 0}\n` +
                        `Errors: ${data.errors?.length || 0}\n\n` +
                        `Full Response:\n${JSON.stringify(data, null, 2)}`, 
                        data.success ? 'success' : 'error'
                    );
                } else {
                    logTest('File Import', false, `HTTP ${response.status}`);
                    showResult('file-results', 
                        `‚ùå File Import FAILED\n\n` +
                        `Status: ${response.status}\n` +
                        `Error: ${JSON.stringify(data, null, 2)}`, 
                        'error'
                    );
                }
                
                setTimeout(() => showProgress(false), 2000);
                
            } catch (error) {
                logTest('File Import', false, error.message);
                showResult('file-results', `‚ùå Error: ${error.message}`, 'error');
                showProgress(false);
            }
        }

        async function testLN01Upload() {
            showResult('endpoint-results', 'üîÑ Testing LN01 upload endpoint...', 'info');
            await testEndpoint('LN01', 'ln01/upload');
        }

        async function testGL01Upload() {
            showResult('endpoint-results', 'üîÑ Testing GL01 upload endpoint...', 'info');
            await testEndpoint('GL01', 'gl01/upload');
        }

        async function testDP01Upload() {
            showResult('endpoint-results', 'üîÑ Testing DP01 upload endpoint...', 'info');
            // Note: DP01 might not have a specific upload endpoint
            await testEndpoint('DP01', 'dp01/upload');
        }

        async function testEndpoint(tableType, endpoint) {
            try {
                // Create a minimal test file
                const testData = tableType === 'LN01' ? 
                    'SourceID,MANDT,BUKRS\nTEST_001,800,7801' :
                    tableType === 'GL01' ?
                    'SourceID,MANDT,BUKRS,GJAHR\nTEST_001,800,7801,2025' :
                    'SourceID,MANDT,KUNNR\nTEST_001,800,1000001';
                
                const blob = new Blob([testData], { type: 'text/csv' });
                const file = new File([blob], `test_${tableType}.csv`, { type: 'text/csv' });
                
                const formData = new FormData();
                formData.append('file', file);
                formData.append('tableName', tableType);
                formData.append('batchId', `TEST_${tableType}_${Date.now()}`);
                formData.append('createdBy', 'TEST_USER');
                
                const response = await fetch(`${API_BASE_URL}/RawDataImport/${endpoint}`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                logTest(`${tableType} Upload Test`, response.ok, `Status: ${response.status}`);
                
                showResult('endpoint-results', 
                    `${response.ok ? '‚úÖ' : '‚ùå'} ${tableType} Upload Test ${response.ok ? 'PASSED' : 'FAILED'}\n\n` +
                    `Endpoint: ${endpoint}\n` +
                    `Status: ${response.status}\n` +
                    `Response: ${JSON.stringify(data, null, 2)}`,
                    response.ok ? 'success' : 'error'
                );
                
            } catch (error) {
                logTest(`${tableType} Upload Test`, false, error.message);
                showResult('endpoint-results', `‚ùå ${tableType} Upload Test FAILED\n\nError: ${error.message}`, 'error');
            }
        }

        async function testHistoryEndpoints() {
            showResult('endpoint-results', 'üîÑ Testing history endpoints...', 'info');
            
            try {
                const ln01Response = await fetch(`${API_BASE_URL}/RawDataImport/ln01/history/TEST_001`);
                const gl01Response = await fetch(`${API_BASE_URL}/RawDataImport/gl01/history/TEST_001`);
                
                const results = [];
                
                if (ln01Response.ok) {
                    const ln01Data = await ln01Response.json();
                    results.push(`‚úÖ LN01 History: ${JSON.stringify(ln01Data)}`);
                    logTest('LN01 History', true, 'LN01 history endpoint accessible');
                } else {
                    results.push(`‚ùå LN01 History: ${ln01Response.status}`);
                    logTest('LN01 History', false, `HTTP ${ln01Response.status}`);
                }
                
                if (gl01Response.ok) {
                    const gl01Data = await gl01Response.json();
                    results.push(`‚úÖ GL01 History: ${JSON.stringify(gl01Data)}`);
                    logTest('GL01 History', true, 'GL01 history endpoint accessible');
                } else {
                    results.push(`‚ùå GL01 History: ${gl01Response.status}`);
                    logTest('GL01 History', false, `HTTP ${gl01Response.status}`);
                }
                
                showResult('endpoint-results', results.join('\n\n'), 'info');
                
            } catch (error) {
                logTest('History Endpoints', false, error.message);
                showResult('endpoint-results', `‚ùå History Endpoints Error: ${error.message}`, 'error');
            }
        }

        async function testSnapshotEndpoints() {
            showResult('endpoint-results', 'üîÑ Testing snapshot endpoints...', 'info');
            
            try {
                const snapshotDate = '2025-06-17';
                const ln01Response = await fetch(`${API_BASE_URL}/RawDataImport/ln01/snapshot?snapshotDate=${snapshotDate}`);
                const gl01Response = await fetch(`${API_BASE_URL}/RawDataImport/gl01/snapshot?snapshotDate=${snapshotDate}`);
                
                const results = [];
                
                if (ln01Response.ok) {
                    const ln01Data = await ln01Response.json();
                    results.push(`‚úÖ LN01 Snapshot: ${JSON.stringify(ln01Data)}`);
                    logTest('LN01 Snapshot', true, 'LN01 snapshot endpoint accessible');
                } else {
                    results.push(`‚ùå LN01 Snapshot: ${ln01Response.status}`);
                    logTest('LN01 Snapshot', false, `HTTP ${ln01Response.status}`);
                }
                
                if (gl01Response.ok) {
                    const gl01Data = await gl01Response.json();
                    results.push(`‚úÖ GL01 Snapshot: ${JSON.stringify(gl01Data)}`);
                    logTest('GL01 Snapshot', true, 'GL01 snapshot endpoint accessible');
                } else {
                    results.push(`‚ùå GL01 Snapshot: ${gl01Response.status}`);
                    logTest('GL01 Snapshot', false, `HTTP ${gl01Response.status}`);
                }
                
                showResult('endpoint-results', results.join('\n\n'), 'info');
                
            } catch (error) {
                logTest('Snapshot Endpoints', false, error.message);
                showResult('endpoint-results', `‚ùå Snapshot Endpoints Error: ${error.message}`, 'error');
            }
        }

        async function testCleanupEndpoints() {
            showResult('endpoint-results', 'üîÑ Testing cleanup endpoints...', 'info');
            
            try {
                // Test cleanup endpoints (but don't actually perform cleanup)
                const response = await fetch(`${API_BASE_URL}/RawDataImport/cleanup/LN01?retainMonths=12`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    logTest('Cleanup Endpoint', true, 'Cleanup endpoint accessible');
                    showResult('endpoint-results', 
                        `‚úÖ Cleanup Endpoint Test PASSED\n\n` +
                        `Response: ${JSON.stringify(data, null, 2)}`, 
                        'success'
                    );
                } else {
                    logTest('Cleanup Endpoint', false, `HTTP ${response.status}`);
                    showResult('endpoint-results', 
                        `‚ùå Cleanup Endpoint Test FAILED\n\n` +
                        `Status: ${response.status}`, 
                        'error'
                    );
                }
                
            } catch (error) {
                logTest('Cleanup Endpoint', false, error.message);
                showResult('endpoint-results', `‚ùå Cleanup Endpoint Error: ${error.message}`, 'error');
            }
        }

        async function runAllTests() {
            showResult('summary-results', 'üöÄ Running comprehensive test suite...', 'info');
            
            // Reset test results
            testResults = { total: 0, passed: 0, failed: 0, tests: [] };
            updateTestStats();
            
            // Run all tests in sequence
            await testApiHealth();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testImportStatistics();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testRecentImports();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testLN01Upload();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testGL01Upload();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testHistoryEndpoints();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testSnapshotEndpoints();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testCleanupEndpoints();
            
            // Generate final summary
            const summary = testResults.tests.map(test => 
                `${test.success ? '‚úÖ' : '‚ùå'} ${test.name}: ${test.details}`
            ).join('\n');
            
            showResult('summary-results', 
                `üèÅ TEST SUITE COMPLETED\n\n` +
                `Total Tests: ${testResults.total}\n` +
                `Passed: ${testResults.passed}\n` +
                `Failed: ${testResults.failed}\n` +
                `Success Rate: ${Math.round((testResults.passed / testResults.total) * 100)}%\n\n` +
                `DETAILED RESULTS:\n${summary}`, 
                testResults.failed === 0 ? 'success' : 'error'
            );
        }

        function clearResults() {
            document.getElementById('api-results').textContent = '';
            document.getElementById('file-results').textContent = '';
            document.getElementById('endpoint-results').textContent = '';
            document.getElementById('summary-results').textContent = '';
            
            testResults = { total: 0, passed: 0, failed: 0, tests: [] };
            updateTestStats();
            
            showProgress(false);
        }

        // Initialize
        updateTestStats();
        
        // Auto-run API health check on load
        setTimeout(() => {
            testApiHealth();
        }, 1000);
    </script>
</body>
</html>
