<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ TinhKhoanApp - Performance Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .demo-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .demo-card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-icon {
            font-size: 2em;
            margin-right: 15px;
        }

        .card-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
        }

        .card-description {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .demo-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
            width: 100%;
        }

        .demo-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .demo-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .performance-stats {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            border-color: #667eea;
            transform: scale(1.05);
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
        }

        .loading {
            display: inline-block;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-name {
            font-weight: 500;
            color: #333;
        }

        .result-time {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
        }

        .time-excellent {
            background: #f6ffed;
            color: #52c41a;
        }

        .time-good {
            background: #f6ffed;
            color: #52c41a;
        }

        .time-fair {
            background: #fff7e6;
            color: #fa8c16;
        }

        .time-poor {
            background: #fff2f0;
            color: #f5222d;
        }

        .api-url {
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #666;
            background: #f1f1f1;
            padding: 2px 6px;
            border-radius: 3px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ TinhKhoanApp Performance Demo</h1>
            <p>Ki·ªÉm tra hi·ªáu su·∫•t c√°c API ƒë√£ ƒë∆∞·ª£c t·ªëi ∆∞u h√≥a</p>
        </div>

        <div class="performance-stats">
            <h2 style="margin-bottom: 20px; color: #333;">üìä Th·ªëng k√™ hi·ªáu su·∫•t t·ªïng quan</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="totalTests">0</div>
                    <div class="stat-label">T·ªïng s·ªë test</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="avgResponse">0ms</div>
                    <div class="stat-label">Th·ªùi gian TB</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="bestResponse">0ms</div>
                    <div class="stat-label">Nhanh nh·∫•t</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="worstResponse">0ms</div>
                    <div class="stat-label">Ch·∫≠m nh·∫•t</div>
                </div>
            </div>
        </div>

        <div class="demo-grid">
            <div class="demo-card">
                <div class="card-header">
                    <div class="card-icon">üìã</div>
                    <div class="card-title">Temporal Imports API</div>
                </div>
                <div class="card-description">
                    Test API l·∫•y danh s√°ch imports t·ª´ Temporal Tables v·ªõi pagination. 
                    Thay th·∫ø cho SCD Type 2 optimized API.
                </div>
                <button class="demo-button" onclick="testOptimizedImports()">
                    <span id="btn-imports">Test Temporal Imports</span>
                </button>
                <div class="api-url">GET /api/temporal/query/RawDataImport</div>
            </div>

            <div class="demo-card">
                <div class="card-header">
                    <div class="card-icon">üìä</div>
                    <div class="card-title">Temporal Query API</div>
                </div>
                <div class="card-description">
                    Test API h·ªó tr·ª£ temporal queries v·ªõi pagination. 
                    T·ªëi ∆∞u cho vi·ªác hi·ªÉn th·ªã d·ªØ li·ªáu historical.
                </div>
                <button class="demo-button" onclick="testVirtualScrolling()">
                    <span id="btn-virtual">Test Virtual Scrolling</span>
                </button>
                <div class="api-url">GET /api/temporal/query/RawData</div>
            </div>

            <div class="demo-card">
                <div class="card-header">
                    <div class="card-icon">‚ö°</div>
                    <div class="card-title">Dashboard Stats API</div>
                </div>
                <div class="card-description">
                    Test API th·ªëng k√™ dashboard v·ªõi caching m·∫°nh. 
                    Truy v·∫•n song song multiple tables.
                </div>
                <button class="demo-button" onclick="testDashboardStats()">
                    <span id="btn-dashboard">Test Dashboard Stats</span>
                </button>
                <div class="api-url">GET /api/temporal/stats/RawData</div>
            </div>

            <div class="demo-card">
                <div class="card-header">
                    <div class="card-icon">üîç</div>
                    <div class="card-title">Advanced Search API</div>
                </div>
                <div class="card-description">
                    Test API t√¨m ki·∫øm n√¢ng cao v·ªõi full-text search 
                    v√† filtering theo multiple criteria.
                </div>
                <button class="demo-button" onclick="testAdvancedSearch()">
                    <span id="btn-search">Test Advanced Search</span>
                </button>
                <div class="api-url">GET /api/temporal/query/RawData</div>
            </div>

            <div class="demo-card">
                <div class="card-header">
                    <div class="card-icon">üéØ</div>
                    <div class="card-title">Temporal History API</div>
                </div>
                <div class="card-description">
                    Test API truy xu·∫•t Temporal Table history v·ªõi 
                    index optimization v√† smart caching.
                </div>
                <button class="demo-button" onclick="testSCDRecords()">
                    <span id="btn-scd">Test Temporal History</span>
                </button>
                <div class="api-url">GET /api/temporal/history/{entityId}</div>
            </div>

            <div class="demo-card">
                <div class="card-header">
                    <div class="card-icon">üìà</div>
                    <div class="card-title">Performance Stats API</div>
                </div>
                <div class="card-description">
                    Test API monitoring hi·ªáu su·∫•t h·ªá th·ªëng 
                    v·ªõi metrics v·ªÅ cache v√† response time.
                </div>
                <button class="demo-button" onclick="testPerformanceStats()">
                    <span id="btn-perf">Test Performance Stats</span>
                </button>
                <div class="api-url">GET /api/temporal/stats/RawData</div>
            </div>
        </div>

        <div class="demo-card" style="margin-bottom: 30px;">
            <div class="card-header">
                <div class="card-icon">üöÄ</div>
                <div class="card-title">Run All Performance Tests</div>
            </div>
            <div class="card-description">
                Ch·∫°y t·∫•t c·∫£ c√°c test hi·ªáu su·∫•t v√† so s√°nh k·∫øt qu·∫£. 
                Bao g·ªìm c·∫£ load testing v·ªõi multiple concurrent requests.
            </div>
            <button class="demo-button" onclick="runAllTests()" style="background: linear-gradient(45deg, #ff6b6b, #ee5a5a);">
                <span id="btn-all">üöÄ Run All Tests</span>
            </button>
        </div>

        <div class="results-section" id="results" style="display: none;">
            <h3 style="margin-bottom: 20px; color: #333;">üìã K·∫øt qu·∫£ ki·ªÉm tra</h3>
            <div id="resultsList"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        const results = [];

        // Utility functions
        function formatTime(ms) {
            if (ms < 1000) {
                return Math.round(ms) + 'ms';
            }
            return (ms / 1000).toFixed(2) + 's';
        }

        function getTimeClass(ms) {
            if (ms < 100) return 'time-excellent';
            if (ms < 500) return 'time-good';
            if (ms < 1000) return 'time-fair';
            return 'time-poor';
        }

        function updateStats() {
            if (results.length === 0) return;

            const times = results.map(r => r.time);
            const totalTests = results.length;
            const avgTime = times.reduce((a, b) => a + b, 0) / times.length;
            const bestTime = Math.min(...times);
            const worstTime = Math.max(...times);

            document.getElementById('totalTests').textContent = totalTests;
            document.getElementById('avgResponse').textContent = formatTime(avgTime);
            document.getElementById('bestResponse').textContent = formatTime(bestTime);
            document.getElementById('worstResponse').textContent = formatTime(worstTime);
        }

        function addResult(name, url, time) {
            results.push({ name, url, time });
            
            const resultsList = document.getElementById('resultsList');
            const resultItem = document.createElement('div');
            resultItem.className = 'result-item';
            resultItem.innerHTML = `
                <div>
                    <div class="result-name">${name}</div>
                    <div class="api-url">${url}</div>
                </div>
                <div class="result-time ${getTimeClass(time)}">${formatTime(time)}</div>
            `;
            resultsList.appendChild(resultItem);
            
            document.getElementById('results').style.display = 'block';
            updateStats();
        }

        async function makeRequest(url, description, buttonId) {
            const button = document.getElementById(buttonId);
            const originalText = button.textContent;
            button.innerHTML = '<span class="loading">‚è≥</span> Testing...';
            button.disabled = true;

            try {
                const startTime = performance.now();
                const response = await fetch(url);
                const endTime = performance.now();
                const responseTime = endTime - startTime;

                if (response.ok) {
                    const data = await response.json();
                    addResult(description, url, responseTime);
                    button.innerHTML = `‚úÖ ${formatTime(responseTime)}`;
                    button.style.background = 'linear-gradient(45deg, #52c41a, #73d13d)';
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                console.error('Error:', error);
                addResult(description + ' (Error)', url, 0);
                button.innerHTML = `‚ùå Error`;
                button.style.background = 'linear-gradient(45deg, #f5222d, #ff4d4f)';
            } finally {
                setTimeout(() => {
                    button.disabled = false;
                    button.innerHTML = originalText;
                    button.style.background = 'linear-gradient(45deg, #667eea, #764ba2)';
                }, 3000);
            }
        }

        // Test functions
        async function testOptimizedImports() {
            await makeRequest(
                `${API_BASE}/temporal/query/RawDataImport?page=1&pageSize=50&sortBy=ImportDate&sortOrder=desc`,
                'Optimized Imports (Paginated)',
                'btn-imports'
            );
        }

        async function testVirtualScrolling() {
            await makeRequest(
                `${API_BASE}/temporal/query/RawData?page=1&pageSize=50`,
                'Virtual Scrolling Records',
                'btn-virtual'
            );
        }

        async function testDashboardStats() {
            await makeRequest(
                `${API_BASE}/temporal/stats/RawData`,
                'Dashboard Statistics (Cached)',
                'btn-dashboard'
            );
        }

        async function testAdvancedSearch() {
            await makeRequest(
                `${API_BASE}/temporal/query/RawData?searchTerm=LN01&page=1&pageSize=25`,
                'Advanced Search (LN01)',
                'btn-search'
            );
        }

        async function testSCDRecords() {
            await makeRequest(
                `${API_BASE}/temporal/history/1?page=1&pageSize=50`,
                'Temporal History Records',
                'btn-scd'
            );
        }

        async function testPerformanceStats() {
            await makeRequest(
                `${API_BASE}/temporal/stats/RawData?timeRange=24h`,
                'Performance Statistics',
                'btn-perf'
            );
        }

        async function runAllTests() {
            const button = document.getElementById('btn-all');
            button.innerHTML = '<span class="loading">‚è≥</span> Running All Tests...';
            button.disabled = true;

            try {
                // Clear previous results
                results.length = 0;
                document.getElementById('resultsList').innerHTML = '';
                document.getElementById('results').style.display = 'none';

                // Run all tests sequentially
                await testOptimizedImports();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testVirtualScrolling();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testDashboardStats();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testAdvancedSearch();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testSCDRecords();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testPerformanceStats();

                // Load test - 5 concurrent requests
                console.log('Running load test...');
                const loadTestStart = performance.now();
                const loadTestPromises = [];
                for (let i = 1; i <= 5; i++) {
                    loadTestPromises.push(
                        fetch(`${API_BASE}/temporal/query/RawDataImport?page=${i}&pageSize=20`)
                    );
                }
                await Promise.all(loadTestPromises);
                const loadTestEnd = performance.now();
                const loadTestTime = loadTestEnd - loadTestStart;
                
                addResult('Load Test (5 concurrent requests)', 'Multiple endpoints', loadTestTime);

                button.innerHTML = 'üéâ All Tests Completed!';
                button.style.background = 'linear-gradient(45deg, #52c41a, #73d13d)';
                
            } catch (error) {
                console.error('Error running all tests:', error);
                button.innerHTML = '‚ùå Some Tests Failed';
                button.style.background = 'linear-gradient(45deg, #f5222d, #ff4d4f)';
            } finally {
                setTimeout(() => {
                    button.disabled = false;
                    button.innerHTML = 'üöÄ Run All Tests';
                    button.style.background = 'linear-gradient(45deg, #ff6b6b, #ee5a5a)';
                }, 5000);
            }
        }

        // Auto-refresh stats every few seconds
        setInterval(updateStats, 2000);
    </script>
</body>
</html>
